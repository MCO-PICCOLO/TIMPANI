syntax = "proto3";

package com.lge.timpani.v1;

service TimpaniConnection {
  // Get SchedInfo from Piccolo
  rpc GetSchedInfo (Empty) returns (SchedInfo) {}

  // Notify Piccolo about a fault
  rpc NotifyFault (FaultInfo) returns (Empty) {}
}

// Empty message for requests and replies that do not require parameters
message Empty {}

message NodeInfo {
  string id = 1;
}

enum SchedPolicy {
  // SCHED_NORMAL
  NORMAL = 0;
  // SCHED_FIFO
  FIFO = 1;
  // SCHED_RR
  RR = 2;
}

message TaskInfo {
  // Unique task name
  string name = 1;
  // Task priority
  int32 priority = 2;
  // Scheduling policy
  SchedPolicy policy = 3;
  // CPU affinity
  uint64 cpu_affinity = 4;
  // Period in us
  int32 period = 5;
  // Release time in us
  int32 release_time = 6;
  // Runtime in us
  int32 runtime = 7;
  // Deadline in us
  int32 deadline = 8;
  // Node ID where the task is running
  string node_id = 9;
  // Maximum number of deadline misses allowed
  int32 max_dmiss = 10;
}

message SchedInfo {
  repeated NodeInfo nodes = 1;
  repeated TaskInfo tasks = 2;
}

enum FaultType {
  // Unknown fault
  UNKNOWN = 0;
  // Deadline miss
  DMISS = 1;
}

message FaultInfo {
  string node_id = 1;
  string task_name = 2;
  FaultType type = 3;
}
